define("modules/clean/profile_services/auth_callback_handler",["require","exports","tslib","modules/core/browser","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/core/i18n"],function(e,r,t,i,o,s,n,c){"use strict";function a(e,r,t,i){e.success&&e.user_id?u(r.loginCont||"/"):e.success?(i&&i(),l({emailSig:e.email_sig,refreshToken:e.refresh_token,profile:e.profile},r,t)):f({errMsg:e.err_msg,rememberMe:e.remember_me,pairUser:e.pair_user,profile:e.profile,emailSig:e.email_sig,refreshToken:e.refresh_token},r.loginCont||"/",t)}function _(e,r){if(e.success)o.Notify.success(c._("Log in successful!")),n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),r.onSuccess(),r.redirectOnSuccess&&i.redirect(r.cont);else if(n.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:e.err_msg}}),"access_denied"===e.err_msg)o.Notify.error(c._("You need to accept Google’s request in order to log in."));else if("emails_do_not_match"===e.err_msg)o.Notify.error(c._("We couldn’t find a Dropbox account matching that email."));else if("google_login_not_allowed"===e.err_msg)o.Notify.error(c._("Google sign in is disabled. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("sso_required"===e.err_msg)o.Notify.error(c._("Your team has single sign-on. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("tfa_required"===e.err_msg){var t=new s.URI({path:"/verify_code",query:{cont:r.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(t)}else if("disabled_account"===e.err_msg)o.Notify.error(c._("This account is disabled."));else if("invalid_pair_target"===e.err_msg)o.Notify.error(c._("That account can’t be paired. Paired account must be a personal account."));else if("already_paired"===e.err_msg)o.Notify.error(c._("That account is already paired to another account."));else if("error_pairing"===e.err_msg)o.Notify.error(c._("There was an error pairing."));else if("not_verified"===e.err_msg){var t=new s.URI({path:"/show_password_form",query:{cont:r.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(t)}else o.Notify.error(c._("We couldn’t log you in with Google.  Try again?"))}function u(e){i.redirect(e)}function l(e,r,t){var o={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,email_sig:e.emailSig,refresh_token:e.refreshToken,cont:r.registerCont,signup_tag:r.signupTag};null!=r.k&&(o.k=r.k),null!=r.eh&&(o.eh=r.eh),null!=r.signupEndpoint&&(o.signup_endpoint=r.signupEndpoint),t&&p(t.form,t.newAccount,o),r.canRedirect&&i.redirect(new s.URI({path:"/third_party_signup",query:o}).toString())}function d(e,r){e.success?(o.Notify.success(c._("Successfully connected your Google Calendar")),r.onSuccess()):o.Notify.error(c._("Couldn’t connect your Google Calendar"))}function p(e,r,t){e.trigger(r,t)}function f(e,r,t){if("tfa_required"===e.errMsg){var n={cont:r};null!=e.pairUser&&(n.pair_user=e.pairUser.toString()),null!=e.rememberMe&&(n.remember_me=e.rememberMe.toString()),i.redirect(new s.URI({path:"/verify_code",query:n}).toString())}else if("sso_required"===e.errMsg){var n={email:e.profile.email,cont:r};i.redirect(new s.URI({path:"/login",query:n}).toString())}else"user_exists"===e.errMsg?(t&&p(t.form,t.userExists,{focus:"input[name=login_password]",prefill:{".login-email":e.profile.email,"input[type='hidden'][name=refresh_token]":e.refreshToken,"input[type='hidden'][name=email_sig]":e.emailSig}}),o.Notify.error(c._("This email address is already taken. Please sign in."))):"user_already_invited_to_team"===e.errMsg?o.Notify.error(c._("Contact your admin to resend your invite.")):o.Notify.error(c._("Unable to link to Google. Please refresh the page to try again."))}Object.defineProperty(r,"__esModule",{value:!0}),i=t.__importStar(i),n=t.__importStar(n),r.handleRegisterResponse=a,r.handleLoginResponse=_,r.handleCalendarLinkResponse=d}),define("modules/clean/profile_services/popup_handler",["require","exports","tslib","external/lodash"],function(e,r,t,i){"use strict";function o(e){var r=i.uniqueId(),t=function(r){var t;try{t=JSON.parse(r.data)}catch(e){return}t&&"db:profile_service:auth_complete"===t.type&&e(t.payload)};return window.addEventListener("message",t),n[r]=t,r}function s(e){var r=n[e];r&&(delete n[e],window.removeEventListener("message",r))}Object.defineProperty(r,"__esModule",{value:!0}),i=t.__importStar(i);var n={};r.addAuthCompleteListener=o,r.removeAuthCompleteListener=s}),define("modules/clean/profile_services/profile_services_constants",["require","exports","modules/core/exception","modules/core/i18n"],function(e,r,t,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",OUTLOOK:"7",SLACK:"8",DOCUSIGN:"9",ZOOM:"10",SLACK_DROPBOX:"11",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY,this.OUTLOOK,this.SLACK,this.DOCUSIGN,this.ZOOM,this.SLACK_DROPBOX]},importable_contact_services:function(){return[this.GOOGLE,this.YAHOO]},to_img:function(e){switch(e){case this.GOOGLE:return["/static/images/contacts/import_icon_gmail-vflFQwVYO.png","/static/images/contacts/import_icon_gmail@2x-vflO2fTFE.png"];case this.YAHOO:case this.YAHOO_LEGACY:return["/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case this.FACEBOOK:return["/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];case this.OUTLOOK:return["/static/images/contacts/import_icon_outlook-vflF1_UKs.png","/static/images/contacts/import_icon_outlook@2x-vflVjRgD3.png"];default:return t.assert(!1,"Should never get ProfileServicesConstants.to_img with service: "+e)}},to_name:function(e){switch(e){case this.GOOGLE:return i._("Gmail");case this.YAHOO:return i._("Yahoo! Mail");case this.FACEBOOK:return i._("Facebook");case this.VARIOUS:return i._("Email");case this.YAHOO_LEGACY:return i._("Yahoo! Mail");case this.OUTLOOK:return i._("Outlook");case this.SLACK:return i._("Slack");case this.DOCUSIGN:return i._("DocuSign");case this.ZOOM:return i._("Zoom");case this.SLACK_DROPBOX:return i._("Slack");default:return t.assert(!1,"Should never get ProfileServicesConstants.to_name with service: "+e)}},logging_identifiers:function(e){switch(e){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";case this.OUTLOOK:return i._("outlook");case this.SLACK:return i._("slack");case this.DOCUSIGN:return"docusign";case this.ZOOM:return"zoom";case this.SLACK_DROPBOX:return"slack_dropbox";default:return t.assert(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+e)}}};r.default=o}),define("modules/clean/profile_services/profile_services_link",["require","exports","tslib","jquery","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/analytics","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/viewer","modules/constants/login_and_register"],function(e,r,t,i,o,s,n,c,a,_,u,l,d,p,f){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),i=t.__importDefault(i),o=t.__importStar(o),_=t.__importStar(_),d=t.__importDefault(d),f=t.__importStar(f);var h=(function(){function e(e,r){void 0===r&&(r=null);var t=this;this._update_on_auth_event=function(e){if(e.user_id===t.user_id){t.is_updated=!1,t.get_or_update_connected_state(!0);for(var r in t.serviceChangeCallbacks)t.serviceChangeCallbacks.hasOwnProperty(r)&&t.serviceChangeCallbacks[r](t)}},s.assert(null!==e,"No user id provided"),this.user_id=e,this.connectedServices={},this.is_updated=!1,this.get_or_update_connected_state(!0,r),this.serviceChangeCallbacks={},l.addAuthCompleteListener(this._update_on_auth_event),i.default(document).on("db:profile_service:deauth_complete",this._update_on_auth_event)}return e.get_linked_profile_services_for_user=function(r,t){void 0===t&&(t=null),s.assert(null!==r,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()");var i=this._LINKED_PROFILE_SERVICES[r];return void 0!==i?i.get_or_update_connected_state(!1,t):(i=new e(r,t),this._LINKED_PROFILE_SERVICES[r]=i),i},e.prototype.get_or_update_connected_state=function(e,r){var t=this;void 0===e&&(e=!1),void 0===r&&(r=null),this.is_updated&&!e?null!==r&&r(this):_.BackgroundRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:function(e,i,o){t.connectedServices=e,t.is_updated=!0,null!==r&&r(t)}})},e.prototype.connected_accounts_for_service=function(e){return this.connectedServices[e]?i.default.map(this.connectedServices[e],function(e){return e.source_id}):[]},e.prototype.has_connected_services=function(){for(var e=0,r=d.default.services();e<r.length;e++){var t=r[e];if(this.service_is_connected(t))return!0}return!1},e.prototype.has_unconnected_services=function(e){void 0===e&&(e=!1);for(var r=e?d.default.importable_contact_services():d.default.services(),t=0,i=r;t<i.length;t++){var o=i[t];if(o!==d.default.YAHOO_LEGACY&&!this.service_is_connected(o))return!0}return!1},e.prototype.service_is_connected=function(e){if(s.assert(d.default.services().indexOf(e)!==-1,"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var r=0,t=this.connectedServices[e];r<t.length;r++){if(t[r].connection_state===d.default.IS_CONNECTED)return!0}return!1},e.prototype.service_was_connected=function(e){if(s.assert(d.default.services().indexOf(e)!==-1,"Not a valid profile service"),null==this.connectedServices[e])return!1;for(var r=0,t=this.connectedServices[e];r<t.length;r++){if(t[r].connection_state===d.default.WAS_CONNECTED)return!0}return!1},e.prototype.register_for_service_changes=function(e,r){return this.serviceChangeCallbacks[e]=r},e._LINKED_PROFILE_SERVICES={},e})();r.LinkedProfileServices=h;var v=(function(){function e(){this._redirect_to_identity_provider=this._redirect_to_identity_provider.bind(this),this.deauth_service=this.deauth_service.bind(this),this._popup_window=null}return e.show_import_notifications=function(e){if(e.success)switch(u.TeamsWebActionsLogger.log("import_contacts_complete",{provider:d.default.logging_identifiers(e.provider),path:o.get_uri().getPath()}),e.provider){case d.default.GOOGLE:c.Notify.success(n._("Imported Gmail Contacts."));break;case d.default.YAHOO:c.Notify.success(n._("Imported Yahoo! Mail contacts."));break;case d.default.OUTLOOK:c.Notify.success(n._("Imported Outlook Mail contacts."));break;case d.default.FACEBOOK:c.Notify.success(n._("Successfully connected to Facebook."))}else null!==e.err_msg?c.Notify.error(e.err_msg):c.Notify.error(n._("There was a problem completing this request."))},e.show_verify_link_result=function(e){return e.success?c.Notify.success(n._("Verified account and imported contacts")):null!==e.err_msg&&void 0!==e.err_msg?c.Notify.error(e.err_msg):c.Notify.error(n._("Couldn’t link account. Please try again."))},e.prototype._attach_popup_handlers=function(e){var r=this,t=null,i=function(i){l.removeAuthCompleteListener(t),null!=r._popup_window&&r._popup_window.close(),r._popup_window=null,null!=e&&e(i)};t=l.addAuthCompleteListener(i)},e.prototype._post_redirect_to_url=function(e,r,t,i){void 0===i&&(i=null);var s=new a.URI({path:"/profile_services/redirect_to_identity_provider",query:r}).toString();if(t){this._attach_popup_handlers(i);var n=d.default.to_name(e);this._popup_window=window.open(s,n,"width=600,height=600,resizable=1,scrollbars=1")}else o.redirect(s)},e.prototype._redirect_to_identity_provider=function(e,r,t,i,o,s,n){void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=!0),void 0===n&&(n=null);var c={service:e,is_popup:s.toString(),action:r,prompt_select:"true",token:f.REDIRECT_WINDOW_TOKEN};return null!==t&&(c.user_id=t.toString()),null!==o&&(c.referrer=o),null==n?c.is_desktop="false":"desktop"===n.kind?(c.is_desktop="true",c.host_nonce=n.host_nonce,null!==n.login_hint&&(c.login_hint=n.login_hint)):(c.is_desktop="false",c.remember_me=n.remember_me.toString(),c.cont=n.cont,c.pair_user=n.pair_user.toString()),this._post_redirect_to_url(e,c,s,i)},e.prototype.auth_service_with_user=function(e,r,t,i){void 0===t&&(t=null),void 0===i&&(i=null),s.assert(null!==e,"No service provided to auth_service_with_user"),s.assert(null!==r,"No user_id provided to auth_service_with_user");var o=p.Viewer.get_viewer().get_user_by_id(r);return s.assert(null!==o,"No user for user_id "+r),this._redirect_to_identity_provider(e,"link_contacts",r,t,i)},e.prototype.auth_service_with_user_promise=function(e,r){var t=this;return new Promise(function(i){t.auth_service_with_user(e,r,i)})},e.prototype.auth_service_with_specified_user=function(e,r,t,i){s.assert(null!==e,"No service provided"),s.assert(null!==r,"No user_id provided");var o=p.Viewer.get_viewer().get_user_by_id(r);return s.assert(null!==o,"No user for user_id "+r),this._redirect_to_identity_provider(e,"link_target_user",r,t,i)},e.prototype.auth_service_create_user_if_needed=function(e,r,t,i){return void 0===r&&(r=null),void 0===t&&(t=null),void 0===i&&(i=!0),s.assert(null!==e,"No service provided to create user"),this._redirect_to_identity_provider(e,"create_user",null,r,t,i)},e.prototype.auth_service_login_desktop=function(e,r,t,i){void 0===i&&(i=null),s.assert(null!==e,"No service provided to login desktop");var o={kind:"desktop",host_nonce:t,login_hint:i};this._redirect_to_identity_provider(e,"login_user",null,r,null,!0,o)},e.prototype.auth_service_login_web=function(e,r,t,i,o,n,c){s.assert(null!==e,"No service provided to login web");var a={kind:"web",remember_me:o,cont:n,pair_user:c};this._redirect_to_identity_provider(e,"login_user",null,r,t,i,a)},e.prototype.auth_service_link_calendar=function(e,r,t,i){s.assert(null!==e,"No service provided"),s.assert(null!==r,"No user_id provided");var o=p.Viewer.get_viewer().get_user_by_id(r);return s.assert(null!==o,"No user for user_id "+r),this._redirect_to_identity_provider(e,"link_calendar",r,t,i,!0)},e.prototype.deauth_service=function(e,r,t,o){void 0===t&&(t=null),void 0===o&&(o=null);var n=parseInt(r,10),c=function(r){if(!r.service_is_connected(e)&&null!==o)return void o(!0);null!==t&&s.assert(r.connected_accounts_for_service(e).indexOf(t)!==-1,"Service is not currently connected"),_.WebRequest({url:"/profile_services/unlink",subject_user:n,data:{service:e,source_id:t},success:function(e,r,t){return i.default(document).trigger(i.default.Event("db:profile_service:deauth_complete",{user_id:n})),"function"==typeof o?o(!0):void 0},error:function(e,r,t){return"function"==typeof o?o(!1):void 0}})};s.assert(d.default.services().indexOf(e)!==-1,"Not a valid profile service"),s.assert(null!==n,"No user_id provided"),h.get_linked_profile_services_for_user(n,c)},e})();r.ProfileServicesLinkingHandler=v});
//# sourceMappingURL=pkg-profile_services.min.js-vflnDt9Ue.map