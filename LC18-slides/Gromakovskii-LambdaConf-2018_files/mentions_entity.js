define(["require","exports","tslib","spectrum_comments/comment_editor/core/class_decorators","spectrum_comments/comment_editor/layers/scaffold","spectrum_comments/comment_editor/core/types","draft-js","spectrum_comments/comment_editor/draft_utils","spectrum_comments/comment_editor/components/mention_span_component"],function(t,e,n,o,r,i,a,s,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.addDecorators=function(t){return t.innerProps.value.concat([{strategy:function(t,e,n){t.findEntityRanges(function(t){var e=t.getEntity();return null!==e&&"mention"===n.getEntity(e).getType()},e)},component:c.MentionSpanComponent}])},e.prototype.initMentions=function(t){var e=t.innerProps,n=e.evt,o=e.value,r=this.splitMentions(n.metadata),i=r.mentions;r.other;return a.EditorState.createWithContent(i.reduce(function(t,e){var n=t.createEntity("mention","IMMUTABLE",{identifier:e.user.identifier,type:e.user.type}),o=n.getLastCreatedEntityKey(),r=s.locationToSelection(e.location,n);return a.Modifier.applyEntity(t,r,o)},o.getCurrentContent()))},e.prototype.postMentions=function(t){var e=t.innerProps,o=e.evt,r=e.value,i=this.getMentionMetadata(a.convertToRaw(o.getCurrentContent())),s=this.splitMentions(r.metadata).other;return n.__assign({},r,{metadata:s.concat(i)})},e.prototype.getMentionMetadata=function(t){var e=t.blocks,n=e.reduce(function(e,n){var o=e.metadata,r=e.pos,i=n.entityRanges;return{metadata:o.concat(i.filter(function(e){return"mention"===t.entityMap[e.key].type}).map(function(e){var n=t.entityMap[e.key].data;return{type:"mention",user:{type:n.type,identifier:n.identifier},location:{start:r+e.offset,end:r+e.offset+e.length}}})),pos:r+n.text.length}},{metadata:[],pos:0}),o=n.metadata;n.pos;return o},e.prototype.splitMentions=function(t){return t.reduce(function(t,e){return"mention"===e.type?{mentions:t.mentions.concat([e]),other:t.other}:{mentions:t.mentions,other:t.other.concat([e])}},{mentions:[],other:[]})},n.__decorate([o.plug(r.into.draft.on.init.update.decorators)],e.prototype,"addDecorators",null),n.__decorate([o.plug(r.into.draft.on.init.update.editorState)],e.prototype,"initMentions",null),n.__decorate([o.plug(r.into.comment.on.post.update.content)],e.prototype,"postMentions",null),e})(i.BaseLayer);e.MentionsEntityLayer=p});
//# sourceMappingURL=mentions_entity.min.js-vfljMUwuH.map